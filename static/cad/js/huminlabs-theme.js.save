/* huminlabs-theme.js â€” HUMIN beige auto-render kick */
(function() {
  const BG_HEX = 0xf4f1de;
  const BG_RGBA = [0.956, 0.945, 0.871, 1.0];

  function applyTheme() {
    try {
      const viewer = window.viewer || window.app?.viewer;
      const scene = viewer?.scene;
      const renderer = viewer?.renderer;
      const gl = renderer?.getContext?.() || viewer?.gl;

      if (scene?.background?.setHex) scene.background.setHex(BG_HEX);
      if (renderer?.setClearColor) renderer.setClearColor(BG_HEX, 1);
      if (gl?.clearColor) gl.clearColor(...BG_RGBA);

      return viewer;
    } catch {
      return null;
    }
  }

  function nudgeCamera(viewer) {
    try {
      // Simulate a subtle zoom and unzoom to force render
      const ctrl = viewer?.sceneSetup?.trackballControls || viewer?.controls;
      if (ctrl?.zoomStep) {
        ctrl.zoomStep(1, -1);
        ctrl.zoomStep(1, 1);
      } else if (viewer?.lookAtObject) {
        // fallback: request a redraw
        viewer.requestRender?.();
      }
    } catch (e) {
      console.warn("HUMIN CAD: nudge failed", e);
    }
  }

  let tries = 0;
  const boot = setInterval(() => {
    const v = applyTheme();
    if (v || ++tries > 80) {
      clearInterval(boot);
      if (v) {
        // force a zoom-like event shortly after boot
        setTimeout(() => {
          nudgeCamera(v);
        }, 600);
      }
    }
  }, 250);

  // Reapply periodically in case of resets
  setInterval(applyTheme, 2500);

  // CSS fallback tint
  const style = document.createElement("style");
  style.textContent = `
    canvas, #viewer-container, #app canvas {
      background-color: #f4f1de !important;
    }`;
  document.head.appendChild(style);
})();
